webpackJsonp([71],{EuOG:function(e,t){},"h/6A":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=r("mvHQ"),a=r.n(o),s=r("Xxa5"),n=r.n(s),i=r("//Fk"),l=r.n(i),u=r("exGp"),m=r.n(u),c=r("3Xzz"),f=r("l46T"),d=r("P9l9"),p=r("Ie7z"),g={name:"store-info",components:{navCrumb:c.a,vueSelectStore:p.a,limitInput:f.a},data:function(){var e=this;return{gicFlag:!(!this.$route.query.gicFlag||"false"==this.$route.query.gicFlag),navpath:[{name:"首页",path:"/index"},{name:"企业通讯录",path:"/administrativeFrame"},{name:"门店架构",path:"/storeFrame"},{name:"添加门店",path:""}],editpath:[{name:"首页",path:"/index"},{name:"企业通讯录",path:"/administrativeFrame"},{name:"门店架构",path:"/storeFrame"},{name:"编辑门店",path:""}],treeSet:{isSelectPerson:!1,dialogVisible:!1,isSingle:!0,groupId:"",openNextBool:!0},disableFlag:!1,defaultList:[],storeInfo:{storeName:"",storeGroupId:"",departmentName:"",imageUrls:[],phoneNumber:"",openTime:"",closeTime:"",shopHours:"",storeType:0,countryId:"",provinceId:"",cityId:"",areaId:"",postAddress:"",longitude:"",latitude:"",location:"",storeArea:"",mangerName:"",storeManagerId:"",managerPhone:"",managerCode:"",maangerSex:"",storeCode:"",storeId:""},areaChainName:"",areaOptions:{},imgs:[],uploadUrl:"/haoban-manage-web/upload-img",rules:{storeName:[{required:!0,message:"请输入门店名称",trigger:"blur"}],departmentName:[{required:!0,message:"请选择所属分组",trigger:"blur"}],groupChainName:[{required:!0,message:"请选择部门",trigger:"change"}],imageUrls:[{type:"array",required:!0,message:"请选择门店图片",trigger:"change"}],areaId:[{required:!0,message:"请选择门店地址",trigger:"blur"}],storeType:[{required:!0,message:"请选择门店类型",trigger:"blur"}],openTime:[{required:!0,validator:function(t,r,o){return r&&e.storeInfo.closeTime?o():o(new Error("请选择营业时间"))},trigger:"blur"}],location:[{required:!0,message:"请选择经纬度",trigger:"blur"}],phoneNumber:[{required:!0,validator:function(t,r,o){if(r)return/^1[34578]\d{9}$/.test(r)||/^(\(\d{3,4}\)|\d{3,4}-|\s)?\d{7,14}$/.test(r)?o():(e.isNew=!0,o(new Error("联系电话格式不正确")));return o(new Error("请输入联系电话"))},trigger:"blur"}],storeCode:[{required:!0,validator:function(e,t,r){if(t)return t.match(/[^\x00-\xff]/gi)?r(new Error("门店代码不能是中文或表情")):r();return r(new Error("请输入门店代码"))},trigger:"blur"}],managerName:[{required:!0,message:"请输入店长姓名",trigger:"blur"}],managerPhone:[{required:!0,validator:function(e,t,r){if(t)return/^1[34578]\d{9}$/.test(t)?r():r(new Error("手机号码格式不正确"));return r(new Error("请输入手机号码"))},trigger:"blur"}],managerCode:[{required:!0,validator:function(e,t,r){if(t)return t.match(/[^\x00-\xff]/gi)?r(new Error("店长代码不能是中文或表情")):r();return r(new Error("请输入店长代码"))},trigger:"blur"}],specialService:[{max:20,message:"长度在 20 个字符以内",trigger:"blur"}],personCost:[{validator:function(e,t,r){if(t)return/^\d+(\.\d+)?$/.test(1*t)?r():r(new Error("人均消费只能为非负整数或者小数"));return r()},trigger:"blur"}]}}},methods:{inputBlur:function(e){this.storeInfo.storeArea||(this.storeInfo.storeArea=""),this.storeInfo.storeArea=Number(this.storeInfo.storeArea.replace(/[^\d.]/g,""))?this.storeInfo.storeArea.replace(/[^\d+(.\d+)]/g,""):"",this.storeInfo.storeArea=Number(this.storeInfo.storeArea).toFixed(2),this.storeInfo.storeArea>=999999&&(this.storeInfo.storeArea=Number(999999).toFixed(2))},callSelector:function(){this.treeSet.dialogVisible=!0},handleSelectedList:function(e){this.storeInfo.groupChainName=e.length?e[0].chainName:"",this.storeInfo.departmentName=e.length?e[0].label:"",this.storeInfo.storeGroupId=e.length?e[0].id:"",this.storeInfo.departmentName&&this.$refs.storeInfo.clearValidate("departmentName")},selected:function(e){this.storeInfo.provinceId=e.province,this.storeInfo.cityId=e.city||"",this.storeInfo.areaId=e.areaId||""},getStoreInfo:function(){var e=this,t={storeId:e.$route.query.storeId};Object(d.a)("/haoban-manage-web/store/findStoreById",t).then(function(t){1==t.data.errorCode?(e.showEmployee="store",e.defaultList=[{id:t.data.result.storeGroupId,label:t.data.result.departmentName}],e.formatStoreInfo(t.data.result)):e.$message.error({message:t.data.message})})},clickToSave:function(){var e=this;return m()(n.a.mark(function t(){var r,o,a,s;return n.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:r=e,o=new l.a(function(e,t){r.$refs.storeInfo.validate(function(t){t&&e()})}),a=new l.a(function(e,t){r.$refs.storeManager.validate(function(t){t&&e()})}),s=new l.a(function(e,t){r.$refs.storeOperate.validate(function(t){t&&e()})}),l.a.all([o,a,s]).then(function(){r.save()});case 5:case"end":return t.stop()}},t,e)}))()},formatStoreInfo:function(e){var t=this;return m()(n.a.mark(function r(){var o,a,s;return n.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:o=t,a=(e.areaChainName||"").split("/"),o.areaOptions={provinceName:a[0],provinceId:e.provinceId,cityName:a[1],cityId:e.cityId,countryName:a[2],countyId:e.countryId},o.imgs=e.imageUrl?e.imageUrl.split(","):[],s=[],o.imgs.forEach(function(e){s.push({url:e})}),e.imageUrls=s,e.location=e.longitude?e.latitude+","+e.longitude:"",o.storeInfo=e,o.disableFlag=!o.isNew&&!!o.storeInfo.managerPhone;case 10:case"end":return r.stop()}},r,t)}))()},uploadOnSuccess:function(e,t){e.file.url=e.res.result[0].qcloudImageUrl,t.push(e.file)},sortImg:function(e){this.storeInfo.imageUrls=e},deleteImage:function(e){this.storeInfo.imageUrls.splice(e,1)},save:function(){var e=this,t=e.storeInfo.location.split(",");e.storeInfo.longitude=t[1],e.storeInfo.latitude=2!==t.length?"":t[0];var r=JSON.parse(a()(e.storeInfo)),o=[];e.storeInfo.imageUrls.forEach(function(e){o.push(e.url)}),r.imageUrls=o.join(",");var s=e.isNew?"/haoban-manage-web/store/insert":"/haoban-manage-web/store/update";Object(d.e)(s,r).then(function(t){1==t.data.errorCode?(e.$message.success({message:t.data.message}),window.history.go(-1)):e.$message.error({message:t.data.message})}).catch(function(t){e.$message.error({message:t.message})})}},computed:{isNew:function(){return!this.$route.query.storeId}},beforeMount:function(){this.treeSet.groupId=this.$route.query.firstLevelId,this.isNew||this.getStoreInfo()},mounted:function(){this.$route.query.storeId&&(this.navpath=this.editpath)}},h={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"common-set-wrap"},[r("nav-crumb",{attrs:{navpath:e.navpath}}),e._v(" "),r("div",{staticClass:"right-content"},[r("div",{staticClass:"right-box"},[r("div",[r("div",{staticClass:"store-info"},[r("div",{staticClass:"info-cell"},[r("p",{staticClass:"title font-w-500"},[e._v("门店信息")]),e._v(" "),r("el-form",{ref:"storeInfo",staticClass:"store-info-form info-form",attrs:{rules:e.rules,model:e.storeInfo,"label-width":"100px"}},[r("el-form-item",{attrs:{label:"门店名称",prop:"storeName"}},[r("limitInput",{attrs:{inputWidth:500,inputValue:e.storeInfo.storeName,holder:"",maxLength:10},on:{"update:inputValue":function(t){e.$set(e.storeInfo,"storeName",t)}}})],1),e._v(" "),r("el-form-item",{attrs:{label:"所属分组",prop:"departmentName"}},[r("el-input",{attrs:{disabled:e.gicFlag},on:{focus:e.callSelector},model:{value:e.storeInfo.groupChainName,callback:function(t){e.$set(e.storeInfo,"groupChainName",t)},expression:"storeInfo.groupChainName"}},[r("i",{staticClass:"el-input__icon el-icon-arrow-down",attrs:{slot:"suffix"},slot:"suffix"})])],1),e._v(" "),r("el-form-item",{attrs:{label:"门店图片",prop:"imageUrls"}},[r("div",{staticClass:"member-upload-image"},[r("vue-office-upload-image",{attrs:{projectName:"haoban-manage-web",wxFlag:"0",actionUrl:e.uploadUrl,imageList:e.storeInfo.imageUrls,limitW:640,limitH:340,maxImageLength:10},on:{uploadOnSuccess:e.uploadOnSuccess,sortImg:e.sortImg,deleteImage:e.deleteImage}})],1),e._v(" "),r("div",{staticClass:"tip font-12 color-909399 m-t-8 line-h-1"},[e._v("门店图片(640*340)，支持.jpg，.jepg，.png类型文件，最多添加10张图片")])]),e._v(" "),r("el-form-item",{attrs:{label:"联系电话",prop:"phoneNumber"}},[r("el-input",{model:{value:e.storeInfo.phoneNumber,callback:function(t){e.$set(e.storeInfo,"phoneNumber",t)},expression:"storeInfo.phoneNumber"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"营业时间",prop:"openTime"}},[r("el-time-select",{attrs:{editable:!1,placeholder:"起始时间","picker-options":{start:"00:00",step:"00:05",end:"24:00"}},model:{value:e.storeInfo.openTime,callback:function(t){e.$set(e.storeInfo,"openTime",t)},expression:"storeInfo.openTime"}}),e._v("\n                ~\n                "),r("el-time-select",{attrs:{editable:!1,placeholder:"结束时间","picker-options":{start:"00:00",step:"00:05",end:"24:00",minTime:e.storeInfo.openTime}},model:{value:e.storeInfo.closeTime,callback:function(t){e.$set(e.storeInfo,"closeTime",t)},expression:"storeInfo.closeTime"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"门店类型",prop:"storeType"}},[r("el-radio-group",{model:{value:e.storeInfo.storeType,callback:function(t){e.$set(e.storeInfo,"storeType",t)},expression:"storeInfo.storeType"}},[r("el-radio",{attrs:{label:0}},[e._v("自营")]),e._v(" "),r("el-radio",{attrs:{label:1}},[e._v("联营")]),e._v(" "),r("el-radio",{attrs:{label:2}},[e._v("代理")]),e._v(" "),r("el-radio",{attrs:{label:3}},[e._v("代销")]),e._v(" "),r("el-radio",{attrs:{label:4}},[e._v("托管")])],1)],1),e._v(" "),r("el-form-item",{attrs:{label:"门店地址",prop:"areaId"}},[r("vue-office-area",{attrs:{areaOptions:e.areaOptions,projectName:"haoban-web",postUrl:"/haoban-manage-web/dict-district-list"},on:{selected:e.selected}}),e._v(" "),r("div",{staticClass:"m-t-15"},[r("limitInput",{attrs:{inputWidth:500,inputValue:e.storeInfo.postAddress,holder:"",maxLength:50},on:{"update:inputValue":function(t){e.$set(e.storeInfo,"postAddress",t)}}})],1)],1),e._v(" "),r("el-form-item",{attrs:{label:"GPS坐标",prop:"location"}},[r("el-input",{staticClass:"m-r-10",model:{value:e.storeInfo.location,callback:function(t){e.$set(e.storeInfo,"location",t)},expression:"storeInfo.location"}}),e._v(" "),r("a",{staticClass:"a-href",attrs:{href:"http://m.gpsspg.com/maps.htm",target:"_blank",rel:"nofollow noopener noreferrer"}},[e._v("经纬度测试工具")])],1),e._v(" "),r("el-form-item",{attrs:{prop:"storeCode"}},[r("template",{slot:"label"},[e._v("\n                  门店代码\n                  ")]),e._v(" "),r("limitInput",{attrs:{inputWidth:500,disflag:e.gicFlag,inputValue:e.storeInfo.storeCode,holder:"",maxLength:20,getByType:"char"},on:{"update:inputValue":function(t){e.$set(e.storeInfo,"storeCode",t)}}})],2),e._v(" "),r("el-form-item",{attrs:{label:"门店面积"}},[r("el-input",{on:{blur:function(t){return e.inputBlur(t)}},model:{value:e.storeInfo.storeArea,callback:function(t){e.$set(e.storeInfo,"storeArea",t)},expression:"storeInfo.storeArea"}}),r("span",{staticClass:"font-14 p-l-10"},[e._v("平方米")])],1)],1)],1),e._v(" "),r("div",{staticClass:"info-cell"},[r("p",{staticClass:"title font-w-500"},[e._v("店长信息")]),e._v(" "),r("el-form",{ref:"storeManager",staticClass:"store-manager-info-form info-form",attrs:{rules:e.rules,model:e.storeInfo,"label-width":"100px"}},[r("el-form-item",{attrs:{label:"店长姓名",prop:"managerName"}},[r("limitInput",{attrs:{inputWidth:500,disflag:e.gicFlag,inputValue:e.storeInfo.managerName,holder:"",maxLength:10},on:{"update:inputValue":function(t){e.$set(e.storeInfo,"managerName",t)}}})],1),e._v(" "),r("el-form-item",{attrs:{label:"手机号码",prop:"managerPhone"}},[r("el-input",{attrs:{disabled:e.disableFlag||e.gicFlag},model:{value:e.storeInfo.managerPhone,callback:function(t){e.$set(e.storeInfo,"managerPhone",t)},expression:"storeInfo.managerPhone"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"店长性别"}},[r("el-radio-group",{attrs:{disabled:e.gicFlag},model:{value:e.storeInfo.managerSex,callback:function(t){e.$set(e.storeInfo,"managerSex",t)},expression:"storeInfo.managerSex"}},[r("el-radio",{attrs:{label:1}},[e._v("男")]),e._v(" "),r("el-radio",{attrs:{label:2}},[e._v("女")])],1)],1),e._v(" "),r("el-form-item",{attrs:{label:"店长代码",prop:"managerCode"}},[r("limitInput",{attrs:{inputWidth:500,disflag:e.gicFlag,inputValue:e.storeInfo.managerCode,holder:"",maxLength:20,getByType:"char"},on:{"update:inputValue":function(t){e.$set(e.storeInfo,"managerCode",t)}}})],1)],1)],1),e._v(" "),r("div",{staticClass:"info-cell"},[r("p",{staticClass:"title font-w-500"},[e._v("经营信息")]),e._v(" "),r("el-form",{ref:"storeOperate",staticClass:"operate-info-form info-form",attrs:{rules:e.rules,model:e.storeInfo,"label-width":"90px"}},[r("el-form-item",{attrs:{label:"特色服务",prop:"specialService"}},[r("el-input",{attrs:{type:"textarea",rows:2},model:{value:e.storeInfo.specialService,callback:function(t){e.$set(e.storeInfo,"specialService",t)},expression:"storeInfo.specialService"}}),e._v(" "),r("p",{staticClass:"counter t-rt c-909399 font-12"},[e._v(e._s((e.storeInfo.specialService||"").length)+"/20")])],1),e._v(" "),r("el-form-item",{attrs:{label:"人均消费",prop:"personCost"}},[r("limitInput",{attrs:{inputWidth:500,inputValue:e.storeInfo.personCost,holder:"",maxLength:10},on:{"update:inputValue":function(t){e.$set(e.storeInfo,"personCost",t)}}})],1),e._v(" "),r("el-form-item",{attrs:{label:"推荐商品"}},[r("el-input",{attrs:{type:"textarea",rows:2},model:{value:e.storeInfo.recommendGoods,callback:function(t){e.$set(e.storeInfo,"recommendGoods",t)},expression:"storeInfo.recommendGoods"}}),e._v(" "),r("p",{staticClass:"counter t-rt c-909399 font-12"},[e._v(e._s((e.storeInfo.recommendGoods||"").length)+"/100")])],1),e._v(" "),r("el-form-item",{attrs:{label:"品牌介绍"}},[r("el-input",{attrs:{type:"textarea",rows:2},model:{value:e.storeInfo.brandDes,callback:function(t){e.$set(e.storeInfo,"brandDes",t)},expression:"storeInfo.brandDes"}}),e._v(" "),r("p",{staticClass:"counter t-rt c-909399 font-12"},[e._v(e._s((e.storeInfo.recommendGoods||"").length)+"/200")])],1)],1)],1),e._v(" "),r("div",{staticClass:"handle-area"},[r("el-button",{attrs:{type:"primary"},on:{click:e.clickToSave}},[e._v("保 存")])],1)]),e._v(" "),r("vue-select-store",{ref:"storeSelector",attrs:{defaultList:e.defaultList,treeSet:e.treeSet,selectType:"group",forbidenList:[e.storeInfo.storeGroupId]},on:{handleSelectedList:e.handleSelectedList}})],1)])])],1)},staticRenderFns:[]};var I=r("VU/8")(g,h,!1,function(e){r("EuOG")},null,null);t.default=I.exports}});