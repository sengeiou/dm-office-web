webpackJsonp([15],{"1Za4":function(e,t){},HHRu:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a("3Xzz"),s=a("n7j5"),n=a("c4uw"),r=a("P9l9"),l={name:"addDepartment",components:{navCrumb:i.a,permissionSetting:s.a,vueSelectEmployee:n.a},data:function(){return{windowH:window.screen.availHeight-180+"px",navpath:[{name:"首页",path:"/index"},{name:"企业通讯录",path:"/administrativeFrame"},{name:"行政架构",path:"/administrativeFrame"},{name:"添加子分组",path:""}],navpathEdit:[{name:"首页",path:"/index"},{name:"企业通讯录",path:"/administrativeFrame"},{name:"行政架构",path:"/administrativeFrame"}],departInfo:{parentName:"",chainName:"",managerClerkList:[]},testList:[],treeSet:{isSelectPerson:!1,dialogVisible:!1,isSingle:!0},rules:{name:[{required:!0,message:"请输入部门名称",trigger:"blur"},{min:1,max:20,message:"长度在 1 到 20 个字符",trigger:"blur"}],chainName:[{required:!0,message:"请选择父级部门",trigger:"blur"}]},treeData:{},disabled:!0,defaultSelection:[],defaultParent:[],selectorType:"parent",changed:"parent",onlyPerson:!1,onlyGroup:[],butList:[],specialList:[],selfButList:[],selfSpecialList:[]}},methods:{delGroup:function(){var e=this;e.$confirm(" 是否确认删除分组 ？","提示",{type:"warning"}).then(function(){Object(r.a)("/haoban-manage-web/dept/del",{groupId:e.$route.query.departmentId}).then(function(t){1==t.data.errorCode?(e.$message.success({message:t.data.message}),window.history.go(-1)):e.$message.error({message:t.data.message})}).catch(function(t){e.$message.error({message:t.message})})}).catch(function(e){})},delCurrentManager:function(e){var t=this.departInfo.managerClerkList;t.splice(t.indexOf(e),1)},getDepartInfo:function(){var e=this,t=this,a={groupId:t.$route.query.departmentId};Object(r.a)("/haoban-manage-web/dept/findDeptById",a).then(function(a){1==a.data.errorCode?e.formatGroupInfo(a.data.result):t.$message.error({duration:1e3,message:a.data.message})}).catch(function(e){t.$message.error({duration:1e3,message:e.message})})},formatGroupInfo:function(e){this.departInfo.parentName=e.chainName,this.defaultParent=[{label:this.departInfo.parentName,id:e.parentId,groupId:e.parentId}],e.managerClerkList=e.managerClerkList?e.managerClerkList:[],e.managerClerkList.forEach(function(e){e.label=e.name,e.id=e.employeeClerkId}),e.noPreClerkList=e.noPreClerkList||[],e.allowClerkList=e.allowClerkList||[],e.allowDeptList=e.allowDeptList||[],e.noPreClerkList.forEach(function(e){e.label=e.name,e.id=e.employeeClerkId}),e.allowClerkList.forEach(function(e){e.label=e.name,e.id=e.employeeClerkId}),e.allowDeptList.forEach(function(e){e.label=e.name,e.id=e.groupId}),1==e.type?(this.butList=e.noPreClerkList,this.specialList=e.allowDeptList.concat(e.allowClerkList),this.selfButList=[],this.selfSpecialList=[]):2==e.type&&(this.butList=[],this.specialList=[],this.selfButList=e.noPreClerkList,this.selfSpecialList=e.allowDeptList.concat(e.allowClerkList)),this.departInfo=e},callGroupSelector:function(){this.selectorType="parent",this.defaultSelection=this.defaultParent,this.onlyPerson=!1,this.onlyGroup=[],this.changed="parent",this.treeSet={dialogVisible:!0,isSingle:!0,isSelectPerson:!1}},callPerSelector:function(e,t){"but"==e||"selectManager"==e?(this.selectorType=e,this.defaultSelection=t,this.onlyPerson=!0,this.onlyGroup=[this.$route.query.departmentId],this.changed=e,this.treeSet={dialogVisible:!0,isSingle:!1,isSelectPerson:!0}):(this.selectorType=e,this.defaultSelection=t,this.onlyPerson=!1,this.onlyGroup=[],this.changed=e,this.treeSet={dialogVisible:!0,isSingle:!1,isSelectPerson:!0})},handleSelectedList:function(e){"parent"==this.changed?(this.departInfo.parentId=e?e.id:"",this.departInfo.parentName=e?e.label:"",this.departInfo.chainName=e?e.chainName:"",this.departInfo.chainName&&this.$refs.departForm.clearValidate("chainName")):"but"==this.changed?2==this.departInfo.type?this.selfButList=e:this.butList=e:"special"==this.changed?2==this.departInfo.type?this.selfSpecialList=e:this.specialList=e:"selectManager"==this.changed&&(this.departInfo.managerClerkList=e)},saveEdit:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=this;this.$refs.departForm.validate(function(a){if(!a)return!1;var i=t.departInfo.type,s=[];""!=i&&t[1==i?"butList":"selfButList"].forEach(function(e){s.push(e.id)});var n=[],l=[];t.specialList.forEach(function(e){e.employeeClerkId?n.push(e.id):l.push(e.id)}),t.selfSpecialList.forEach(function(e){e.employeeClerkId?n.push(e.id):l.push(e.id)});var o=s.join(","),c=[];t.departInfo.managerClerkList.forEach(function(e){c.push(e.id)});var d={type:i,managerClerkIds:c=c.join(","),noPreCherkIds:o,allowCherkIds:n.join(","),allowDepartIds:l.join(","),parentId:t.departInfo.parentId,name:t.departInfo.name};t.isAddNew||(d.groupId=t.$route.query.departmentId,d.isStoreGroup=0);var u=t.isAddNew?"/haoban-manage-web/dept/insert":"/haoban-manage-web/dept/update";Object(r.a)(u,d).then(function(a){1==a.data.errorCode?(t.$message.success({duration:1e3,message:"操作成功！"}),"continue"==e?(t.departInfo={name:"",parentName:"",parentId:""},t.disabled=!0,t.getGroupData()):window.history.go(-1)):t.$message.error({duration:1e3,message:a.data.message})}).catch(function(e){t.$message.error({duration:1e3,message:e.message})})})},getGroupData:function(){var e=this;Object(r.a)("/haoban-manage-web/dept/deptListForCompany",{isStoreGroup:0}).then(function(t){var a=[],i=[];1==t.data.errorCode&&(a=t.data.result.departmentList||[],i=t.data.result.searchList||[]),e.treeData={treeData:a,personData:i},e.disabled=!1}).catch(function(e){})},cancel:function(){this.$confirm(" 是否确认取消，取消后当前页面信息将丢失 ？","提示",{type:"warning"}).then(function(){window.history.go(-1)}).catch(function(e){})}},beforeMount:function(){this.getGroupData(),this.isAddNew||(this.getDepartInfo(),this.navpathEdit.push({name:"编辑"+("company"==this.$route.query.type?"企业信息":"部门信息"),path:""}),this.navpath=this.navpathEdit),this.$nextTick(function(){document.querySelector(".contact-wrap__body").style.overflow="hidden"})},beforeDestroy:function(){document.querySelector(".contact-wrap__body").style.overflow="auto"},computed:{isAddNew:function(){return!(1!=this.$route.query.addnew)}}},o={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"common-set-wrap",style:{height:e.windowH}},[a("nav-crumb",{attrs:{navpath:e.navpath}}),e._v(" "),a("div",{staticClass:"right-content"},[a("div",{staticClass:"right-box"},[a("div",{staticClass:"add-department-container"},["group"==e.$route.query.type?a("div",{staticClass:"setting-cell depart-info"},[a("p",{staticClass:"title"},[e._v("部门信息")]),e._v(" "),a("el-form",{ref:"departForm",staticClass:"department-info-form",attrs:{"label-position":"right",rules:e.rules,model:e.departInfo,"label-width":"120px"}},[a("el-form-item",{attrs:{label:"部门名称",prop:"name"}},[a("el-input",{model:{value:e.departInfo.name,callback:function(t){e.$set(e.departInfo,"name",t)},expression:"departInfo.name"}})],1),e._v(" "),e.isAddNew?e._e():a("el-form-item",{attrs:{label:"部门负责人"}},[a("ul",{staticClass:"particular-list",staticStyle:{"margin-bottom":"0",width:"380px"}},[e._l(e.departInfo.managerClerkList,function(t,i){return[a("li",{key:i+"_"+t.id,staticClass:"item person-item",staticStyle:{"margin-top":"0"}},[t.headPic?a("img",{attrs:{src:t.headPic}}):a("div",{staticClass:"replace-head-img"},[a("i",{staticClass:"iconfont icon-yewuduanmorentouxian"})]),e._v(" "),a("p",{staticClass:"name"},[e._v(e._s(t.label))]),e._v(" "),a("i",{staticClass:"el-icon-circle-close",on:{click:function(a){e.delCurrentManager(t)}}})])]}),e._v(" "),a("li",{staticClass:"item J_add-btn",staticStyle:{"margin-top":"0"},on:{click:function(t){e.callPerSelector("selectManager",e.departInfo.managerClerkList)}}},[a("i",{staticClass:"el-icon-plus"})])],2)]),e._v(" "),a("el-form-item",{attrs:{label:"部门排序调整",prop:"chainName"}},[a("el-input",{attrs:{disabled:e.disabled,"suffix-icon":"el-icon-arrow-down"},on:{focus:e.callGroupSelector},model:{value:e.departInfo.chainName,callback:function(t){e.$set(e.departInfo,"chainName",t)},expression:"departInfo.chainName"}})],1)],1)],1):a("div",{staticClass:"setting-cell depart-info"},[a("p",{staticClass:"title"},[e._v("企业信息")]),e._v(" "),a("el-form",{ref:"departForm",staticClass:"department-info-form",attrs:{"label-position":"right",rules:e.rules,model:e.departInfo,"label-width":"120px"}},[a("el-form-item",{attrs:{label:"企业名称",prop:"name"}},[a("el-input",{attrs:{disabled:""},model:{value:e.departInfo.name,callback:function(t){e.$set(e.departInfo,"name",t)},expression:"departInfo.name"}})],1)],1)],1),e._v(" "),e.isAddNew?e._e():a("div",{staticClass:"setting-cell m-b-48"},[a("p",{staticClass:"title"},[e._v("权限设置")]),e._v(" "),e.disabled?e._e():a("permission-setting",{attrs:{departInfo:e.departInfo,selfButList:e.selfButList,selfSpecialList:e.selfSpecialList,butList:e.butList,specialList:e.specialList,visibleSpecialLsit:e.testList,onlySelfApartList:e.testList,treeData:e.treeData},on:{callPerSelector:e.callPerSelector}})],1),e._v(" "),a("div",{staticClass:"setting-cell fixed-footer"},[a("div",{staticClass:"btn-area"},[a("el-button",{attrs:{type:"primary"},on:{click:e.saveEdit}},[e._v("保 存")]),e._v(" "),e.isAddNew?a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.saveEdit("continue")}}},[e._v("保存并继续添加")]):"group"==e.$route.query.type?a("el-button",{attrs:{type:"danger"},on:{click:e.delGroup}},[e._v("删 除")]):e._e(),e._v(" "),a("el-button",{on:{click:e.cancel}},[e._v("取 消")])],1)]),e._v(" "),a("vue-select-employee",{attrs:{changed:e.changed,onlyPerson:e.onlyPerson,onlyGroup:e.onlyGroup,defaultSelection:e.defaultSelection,treeSet:e.treeSet,treeData:e.treeData},on:{handleSelectedList:e.handleSelectedList}})],1)])])],1)},staticRenderFns:[]};var c=a("VU/8")(l,o,!1,function(e){a("1Za4")},null,null);t.default=c.exports},HKlq:function(e,t){},n7j5:function(e,t,a){"use strict";var i=a("mvHQ"),s=a.n(i),n={name:"select-area",components:{vueSelectEmployee:a("c4uw").a},props:{treeData:{type:Object,default:function(){return{}}},butList:{type:Array,default:function(){return[]}},specialList:{type:Array,default:function(){return[]}}},data:function(){return{copyTreeData:JSON.parse(s()(this.treeData))}},methods:{delCurrent:function(e,t){var a=this[t];a.splice(a.indexOf(e),1)},handleSelectedList:function(e){this.butList=e},callSelector:function(e,t){this.$emit("callPerSelector",e,t)}}},r={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"select-area"},[a("div",{staticClass:"setting-name"},[e._v("\n    个别员工不设置该权限\n  ")]),e._v(" "),a("ul",{staticClass:"particular-list"},[e._l(e.butList,function(t,i){return[t.employeeClerkId?a("li",{key:i+"_"+t.employeeClerkId,staticClass:"item person-item"},[t.headPic?a("img",{attrs:{src:t.headPic}}):a("div",{staticClass:"replace-head-img"},[a("i",{staticClass:"iconfont icon-yewuduanmorentouxian"})]),e._v(" "),a("p",{staticClass:"name"},[e._v(e._s(t.label))]),e._v(" "),a("i",{staticClass:"el-icon-circle-close",on:{click:function(a){e.delCurrent(t,"butList")}}})]):a("li",{key:i+"_"+t.groupId,staticClass:"item group-item"},[e._v("\n        "+e._s(t.label)+"\n        "),a("i",{staticClass:"el-icon-circle-close",on:{click:function(a){e.delCurrent(t,"butList")}}})])]}),e._v(" "),a("li",{staticClass:"item J_add-btn",on:{click:function(t){e.callSelector("but",e.butList)}}},[a("i",{staticClass:"el-icon-plus"})])],2),e._v(" "),a("div",{staticClass:"setting-name"},[e._v("\n    允许指定部门/人员可见\n  ")]),e._v(" "),a("ul",{staticClass:"particular-list"},[e._l(e.specialList,function(t,i){return[t.employeeClerkId?a("li",{key:i+"_"+t.employeeClerkId,staticClass:"item person-item"},[t.headPic?a("img",{attrs:{src:t.headPic}}):a("div",{staticClass:"replace-head-img"},[a("i",{staticClass:"iconfont icon-yewuduanmorentouxian"})]),e._v(" "),a("p",{staticClass:"name"},[e._v(e._s(t.label))]),e._v(" "),a("i",{staticClass:"el-icon-circle-close",on:{click:function(a){e.delCurrent(t,"specialList")}}})]):a("li",{key:i+"_"+t.groupId,staticClass:"item group-item"},[e._v("\n        "+e._s(t.label)+"\n        "),a("i",{staticClass:"el-icon-circle-close",on:{click:function(a){e.delCurrent(t,"specialList")}}})])]}),e._v(" "),a("li",{staticClass:"item J_add-btn",on:{click:function(t){e.callSelector("special",e.specialList)}}},[a("i",{staticClass:"el-icon-plus"})])],2)])},staticRenderFns:[]};var l={name:"permissionSetting",components:{selectArea:a("VU/8")(n,r,!1,function(e){a("HKlq")},null,null).exports},props:{butList:{type:Array,default:function(){return[]}},specialList:{type:Array,default:function(){return[]}},selfButList:{type:Array,default:function(){return[]}},selfSpecialList:{type:Array,default:function(){return[]}},visibleSpecialLsit:{type:Array,default:function(){return[]}},onlySelfApartList:{type:Array,default:function(){return[]}},treeData:{type:Object,default:function(){return{}}},departInfo:{type:Object,default:function(){return{}}}},data:function(){return{visibleThere:!1,visibleSelf:!1}},methods:{switchPermission:function(e,t,a){e&&(this[a]=!e),this.visibleSelf?this.departInfo.type=2:this.visibleThere?this.departInfo.type=1:this.departInfo.type=""},callPerSelector:function(e,t){this.$emit("callPerSelector",e,t)}},mounted:function(){var e=this.departInfo.type;this.visibleThere=!(1!=e),this.visibleSelf=!(2!=e)},watch:{departInfo:{handler:function(e,t){var a=e.type;this.visibleThere=!(1!=a),this.visibleSelf=!(2!=a)},deep:!0}}},o={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"jurisdiction-setting"},[a("div",{staticClass:"only-visivble-there permission-div"},[a("div",{staticClass:"permission-div-title"},[a("span",[e._v("本部门员工仅可见本部门员工")]),e._v(" "),a("el-switch",{attrs:{"active-color":"#409EFF","inactive-color":"#DCDFE6"},on:{change:function(t){e.switchPermission(e.visibleThere,"visibleThere","visibleSelf")}},model:{value:e.visibleThere,callback:function(t){e.visibleThere=t},expression:"visibleThere"}})],1),e._v(" "),e.visibleThere?a("div",{staticClass:"particular-setting"},[a("select-area",{attrs:{treeData:e.treeData,butList:e.butList,specialList:e.specialList},on:{callPerSelector:e.callPerSelector}})],1):e._e()]),e._v(" "),a("div",{staticClass:"only-visivble-self permission-div"},[a("div",{staticClass:"permission-div-title"},[a("span",[e._v("本部门员工仅可见自己")]),e._v(" "),a("el-switch",{attrs:{"active-color":"#409EFF","inactive-color":"#DCDFE6"},on:{change:function(t){e.switchPermission(e.visibleSelf,"visibleSelf","visibleThere")}},model:{value:e.visibleSelf,callback:function(t){e.visibleSelf=t},expression:"visibleSelf"}})],1),e._v(" "),e.visibleSelf?a("div",{staticClass:"particular-setting"},[a("select-area",{attrs:{treeData:e.treeData,butList:e.selfButList,specialList:e.selfSpecialList},on:{callPerSelector:e.callPerSelector}})],1):e._e()])])},staticRenderFns:[]};var c=a("VU/8")(l,o,!1,function(e){a("wVEX")},null,null);t.a=c.exports},wVEX:function(e,t){}});