webpackJsonp([50],{TTY7:function(e,t){},"rs/A":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r("mvHQ"),s=r.n(a),l=r("3Xzz"),o=r("c4uw"),i=r("Ie7z"),n=r("3E4D"),c=r("Ch4/"),u=r("PI0u"),d=r("P9l9"),m={name:"addAdminRole",data:function(){return{navpath:[{name:"首页",path:"/index"},{name:"设置",path:"/companyAddress"},{name:"设置子管理员",path:"/setChildAdmin"},{name:"添加成员",path:""}],ruleForm:{brandId:"",roleId:"",roleCode:"admin",roleName:"企业管理员",peopleList:[],departList:[],brandValue:[],brandOptions:[]},rules:{},treeSet:{isSelectPerson:!1,dialogVisible:!1,isSingle:!1},treeData:{},defaultSelection:[],changed:"",onlyPerson:!1,selectType:"",defaultStoreList:[],storeTreeSet:{isSelectPerson:!1,dialogVisible:!1,isSingle:!1}}},computed:{},methods:{changeRoute:function(e){this.$router.push(e)},submitForm:Object(u.a)(function(e){var t=this;t.$refs[e].validate(function(e){if(!e)return!1;var r=[],a=t.ruleForm.peopleList.length;if(a){a=null,t.ruleForm.departList.forEach(function(e){r.push({groupId:e.groupId})}),t.ruleForm.brandValue.forEach(function(e){"admin"===t.ruleForm.roleCode?r.push({groupId:e}):e.storeId?r.push({storeId:e.storeId}):r.push({groupId:e.groupId})});var s=t.ruleForm.peopleList.map(function(e){return e.employeeClerkId}).join(",");t.postSave(r,s)}else t.$message.error({message:"请完善信息"})})},500),postSave:function(e,t){var r=this,a={data:s()(e),roleId:r.ruleForm.roleId,brandId:r.ruleForm.brandId,clerkIds:t};Object(d.e)("/haoban-manage-web/save-clerk-role",a).then(function(e){var t=e.data;if(1==t.errorCode)return n.a.showmsg("添加成功","success"),void r.changeRoute("/setChildAdmin");c.a.errorMsg(t)}).catch(function(e){r.$message.error({duration:1e3,message:e.message})})},delField:function(e,t,r){this.$alert("确定要删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消"}).then(function(t){t.value;r.splice(e,1)}).catch(function(){})},delDepart:function(e,t){t.splice(e,1)},showDialogLayer:function(e,t){if(this.selectType=e,this.changed=e,"store"===e)return this.defaultStoreList=t,void(this.storeTreeSet={dialogVisible:!0,isSingle:!1,isSelectPerson:!0});this.treeSet={dialogVisible:!0,isSingle:!1,isSelectPerson:!1},"people"===e?(this.onlyPerson=!0,this.treeSet={dialogVisible:!0,isSingle:!1,isSelectPerson:!0}):this.onlyPerson=!1,this.defaultSelection=t,this.treeData.hasOwnProperty("treeData")},handleSelectedList:function(e){"people"===this.selectType?this.ruleForm.peopleList=e:"store"===this.selectType?this.ruleForm.brandValue=e:this.ruleForm.departList=e},getBrandData:function(){var e=this;Object(d.e)("/haoban-manage-web/brand/list",{}).then(function(t){var r=t.data;1!=r.errorCode?c.a.errorMsg(r):r.result&&r.result.length&&(e.ruleForm.brandOptions=r.result)}).catch(function(t){e.$message.error({duration:1e3,message:t.message})})},getUserData:function(){var e=this,t={roleId:e.ruleForm.roleId,userId:e.ruleForm.userId,brandId:e.ruleForm.brandId};Object(d.e)("/haoban-manage-web/find-clerk-role",t).then(function(t){var r=t.data;1!=r.errorCode?c.a.errorMsg(r):r.result&&(e.ruleForm.peopleList=[r.result.user],r.result.admList.forEach(function(e,t){e.id=e.groupId,e.label=e.name}),e.ruleForm.departList=r.result.admList||[],r.result.storeList.forEach(function(e,t){e.id=e.groupId?e.groupId:e.storeId,e.label=e.name}),e.ruleForm.brandValue="admin"===e.ruleForm.roleCode?r.result.storeList.map(function(e){return e.groupId}):r.result.storeList||[])}).catch(function(t){e.$message.error({duration:1e3,message:t.message})})}},mounted:function(){this.getBrandData(),this.ruleForm.brandId=this.$route.query.brandId,this.$route.query.hasOwnProperty("roleId")&&(this.ruleForm.roleId=this.$route.query.roleId),this.$route.query.hasOwnProperty("roleCode")&&(this.ruleForm.roleCode=this.$route.query.roleCode,this.ruleForm.roleName="admin"===this.$route.query.roleCode?"企业管理员":"子管理员"),this.$route.query.hasOwnProperty("userId")&&(this.ruleForm.userId=this.$route.query.userId,this.navpath=[{name:"首页",path:"/index"},{name:"设置",path:"/companyAddress"},{name:"设置子管理员",path:"/setChildAdmin"},{name:"编辑成员",path:""}],this.getUserData())},components:{navCrumb:l.a,vueSelectEmployee:o.a,vueSelectStore:i.a}},p={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"companyAddress-wrap common-set-wrap"},[r("nav-crumb",{attrs:{navpath:e.navpath}}),e._v(" "),r("div",{staticClass:"right-content"},[r("div",{staticClass:"right-box",style:{height:e.$store.state.bgHeight}},[r("el-form",{ref:"ruleForm",staticClass:"demo-ruleForm",attrs:{model:e.ruleForm,rules:e.rules,"label-width":"100px"}},[r("el-form-item",{attrs:{label:"管理员角色",prop:"roleName"}},[r("el-input",{staticClass:"w-380",attrs:{disabled:"",placeholder:""},model:{value:e.ruleForm.roleName,callback:function(t){e.$set(e.ruleForm,"roleName",t)},expression:"ruleForm.roleName"}})],1),e._v(" "),r("el-form-item",{attrs:{label:e.ruleForm.userId?"":"选择人员",prop:"name"}},[r("div",{staticClass:"flex w-380 flex-wrap"},[e._l(e.ruleForm.peopleList,function(t,a){return[r("div",{key:a+t.name,staticClass:"people-cell flex flex-align-center flex-pack-center flex-column"},[r("div",{class:["inline-block","img-wrap","flex","flex-align-center","flex-pack-center",t.headPic?"":"img-wrap-bg"]},[t.headPic?r("img",{attrs:{src:t.headPic,alt:"headPic"}}):r("i",{staticClass:"iconfont icon-yewuduanmorentouxian"}),e._v(" "),e.ruleForm.userId?e._e():r("i",{staticClass:"el-icon-circle-close",on:{click:function(r){r.stopPropagation(),e.delField(a,t,e.ruleForm.peopleList)}}})]),e._v(" "),r("p",[e._v(e._s(t.name))])])]}),e._v(" "),e.ruleForm.userId?e._e():r("div",{staticClass:"people-cell"},[r("span",{staticClass:"add-icon",on:{click:function(t){t.stopPropagation(),e.showDialogLayer("people",e.ruleForm.peopleList)}}},[r("i",{staticClass:"el-icon-plus"})])])],2)]),e._v(" "),r("el-form-item",{staticClass:"m-b-0",attrs:{label:"选择管理范围",prop:"name"}}),e._v(" "),r("el-form-item",{staticClass:"m-b-0 m-t-10",attrs:{label:"行政架构",prop:"name"}},[r("div",{staticClass:"flex w-380 flex-column item-cell-select"},[r("div",{staticClass:"depart-item-wrap"},[r("div",{staticClass:"el-select el-select--large depart-item-content",on:{click:function(t){e.showDialogLayer("depart",e.ruleForm.departList)}}},[r("div",{staticClass:"el-select__tags",staticStyle:{"max-width":"181px"}},[r("span",[e._l(e.ruleForm.departList,function(t,a){return[r("span",{key:a,staticClass:"el-tag el-tag--info el-tag--small"},[r("span",{staticClass:"el-select__tags-text"},[e._v(e._s(t.name))]),r("i",{staticClass:"el-tag__close el-icon-close",on:{click:function(t){t.stopPropagation(),e.delDepart(a,e.ruleForm.departList)}}})])]})],2)])])])])]),e._v(" "),r("el-form-item",{staticClass:"m-t-22",attrs:{label:"门店架构",prop:"name"}},[r("div",{staticClass:"flex w-380 flex-column item-cell-select"},["admin"==e.ruleForm.roleCode?r("div",{staticClass:"store-item-wrap"},[r("el-select",{staticStyle:{width:"213px"},attrs:{multiple:"",placeholder:"请选择"},model:{value:e.ruleForm.brandValue,callback:function(t){e.$set(e.ruleForm,"brandValue",t)},expression:"ruleForm.brandValue"}},e._l(e.ruleForm.brandOptions,function(e){return r("el-option",{key:e.groupId,attrs:{label:e.name,value:e.groupId}})}))],1):e._e(),e._v(" "),"child_admin"==e.ruleForm.roleCode?r("div",{staticClass:"depart-item-wrap"},[r("div",{staticClass:"el-select el-select--large depart-item-content",staticStyle:{width:"213px"},on:{click:function(t){e.showDialogLayer("store",e.ruleForm.brandValue)}}},[r("div",{staticClass:"el-select__tags",staticStyle:{"max-width":"181px"}},[r("span",[e._l(e.ruleForm.brandValue,function(t,a){return[r("span",{key:a,staticClass:"el-tag el-tag--info el-tag--small"},[r("span",{staticClass:"el-select__tags-text"},[e._v(e._s(t.name||t.storeName))]),r("i",{staticClass:"el-tag__close el-icon-close",on:{click:function(t){t.stopPropagation(),e.delDepart(a,e.ruleForm.brandValue)}}})])]})],2)])])]):e._e()])]),e._v(" "),r("el-form-item",{staticClass:"m-t-24"},[r("el-button",{attrs:{type:"primary"},on:{click:function(t){e.submitForm("ruleForm")}}},[e._v("保存")])],1)],1)],1)]),e._v(" "),r("vue-gic-footer"),e._v(" "),r("vue-select-employee",{attrs:{defaultSelection:e.defaultSelection,onlyPerson:e.onlyPerson,treeSet:e.treeSet,changed:e.changed},on:{handleSelectedList:e.handleSelectedList}}),e._v(" "),r("vue-select-store",{ref:"storeSelector",attrs:{treeSet:e.storeTreeSet,selectType:"group-store",defaultList:e.defaultStoreList},on:{handleSelectedList:e.handleSelectedList}})],1)},staticRenderFns:[]};var h=r("VU/8")(m,p,!1,function(e){r("TTY7")},"data-v-57c540df",null);t.default=h.exports}});