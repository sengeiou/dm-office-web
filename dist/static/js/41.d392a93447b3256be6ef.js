webpackJsonp([41],{iG3v:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=a("fZjL"),n=a.n(o),i=a("2eFk"),s=a("Ie7z"),l=a("Ke24"),r=a("LRn8"),c=a("P9l9"),d=a("PI0u"),u=a("3E4D"),p=a("Ch4/"),h={name:"reviewed",props:{brandId:{type:String,default:function(){return""}},activeGroupId:{type:String,default:function(){return""}}},data:function(){return{tableH:window.screen.availHeight-464-126,activeTab:"1",activeBrand:this.brandId,activeGroup:this.activeGroupId,topMenuData:[{id:"1",name:"话务任务记录"}],activeId:"1",showDialog:!1,conditionObj:{searchInput:"",storeGroup:[],storeType:"",dateRange:[]},storeTypeOptions:[{value:"",label:"所有"},{value:"0",label:"自营"},{value:"1",label:"联营"},{value:"2",label:"代理"},{value:"3",label:"代销"},{value:"4",label:"托管"}],selectRadio:0,tableData:[],multipleSelection:[],currentPage:1,pageSize:20,total:0,appScene:2,defaultStoreList:[],storeTreeSet:{isSelectPerson:!1,dialogVisible:!1,isSingle:!1}}},computed:{},methods:{handleCommand:function(t){this.selectRadio=t},setSelectTab:function(t){this.activeTab=t.tabId},toInput:Object(d.a)(function(t,e){this.currentPage=1,this.getTableList()},500),changeStoreType:function(){this.currentPage=1,this.getTableList()},changeDate:function(t){t||(this.conditionObj.dateRange=[]),this.currentPage=1,this.getTableList()},handleSelectionChange:function(t){this.multipleSelection=t},delDepart:function(t,e){e.splice(t,1),this.currentPage=1,this.getTableList()},multDel:function(){if(!this.multipleSelection.length)return this.$message.error({duration:1e3,message:"请选择删除项"}),!1;this.showDialog=!0},hideDialog:function(t){if(this.showDialog=!1,!n()(t).length)return!1;this.postMultDel(t)},postMultDel:function(t){var e=this,a=[],o=[];e.conditionObj.storeGroup.forEach(function(t){2==t.type&&a.push(t.groupId),3==t.type&&o.push(t.storeId)});var n={search:e.conditionObj.searchInput||"",filterStoreIds:o.join(",")||"",storeGroupIds:a.join(",")||"",storeIds:e.multipleSelection.map(function(t){return t.storeId}).join(",")||"",storeType:e.conditionObj.storeType||"",startDate:e.conditionObj.dateRange[0]||"",endDate:e.conditionObj.dateRange[1]||"",brandId:e.activeBrand,delTaskStatus:t.delOptFlag,reason:t.reason,isAll:e.selectRadio};Object(c.e)("/haoban-app-tel-task-web/task/batch-del-store-task-list",n).then(function(t){var a=t.data;if(1==a.errorCode)return u.a.showmsg("删除成功","success"),void e.getTableList();p.a.errorMsg(a)}).catch(function(t){e.$message.error({duration:1e3,message:t.message})})},exportExcel:function(){var t=this,e=[],a=[];t.conditionObj.storeGroup.forEach(function(t){2==t.type&&e.push(t.groupId),3==t.type&&a.push(t.storeId)});var o={search:t.conditionObj.searchInput||"",filterStoreIds:a.join(",")||"",storeGroupIds:e.join(",")||"",storeType:t.conditionObj.storeType||"",startDate:t.conditionObj.dateRange?t.conditionObj.dateRange[0]:"",endDate:t.conditionObj.dateRange?t.conditionObj.dateRange[1]:"",brandId:t.activeBrand};Object(c.b)("/haoban-app-tel-task-web/task/export-store-task-list",o).then(function(e){if(!e.data)return p.a.errorMsg("暂无数据"),!1;var a=new Blob([e.data],{type:"application/vnd.ms-excel"}),o=(t.tableData[0]?t.tableData[0].storeName:"")+"门店任务报表.csv",n=document.createElement("a");n.download=o,n.style.display="none",n.href=URL.createObjectURL(a),document.body.appendChild(n),n.click(),URL.revokeObjectURL(n.href),document.body.removeChild(n)}).catch(function(e){t.$message.error({duration:1e3,message:e.message})})},handleSizeChange:function(t){this.pageSize=t,this.getTableList()},handleCurrentChange:function(t){this.currentPage=t,this.getTableList()},showDialogLayer:function(t,e){this.selectType=t,this.changed=t,this.defaultStoreList=e,this.storeTreeSet={dialogVisible:!0,isSingle:!1,isSelectPerson:!1}},handleSelectedList:function(t){this.conditionObj.storeGroup=t,this.getTableList()},toDetail:function(t,e){this.$router.push("taskDetail?storeId="+e.storeId+"&appIcon="+this.$route.query.appIcon)},getTableList:function(t){var e=this,a=[],o=[];e.conditionObj.storeGroup.forEach(function(t){2==t.type&&a.push(t.groupId),3==t.type&&o.push(t.storeId)});var n={search:e.conditionObj.searchInput||"",filterStoreIds:o.join(",")||"",storeGroupIds:a.join(",")||"",storeType:e.conditionObj.storeType||"",startDate:e.conditionObj.dateRange[0]||"",endDate:e.conditionObj.dateRange[1]||"",pageNum:e.currentPage,pageSize:e.pageSize,brandId:e.activeBrand};Object(c.a)("/haoban-app-tel-task-web/task/store-task-list",n).then(function(t){var a=t.data;if(1==a.errorCode)return e.tableData=a.result.list||[],e.total=a.result.pageInfo.total,!1;p.a.errorMsg(a)}).catch(function(t){e.$message.error({duration:1e3,message:t.message})})}},watch:{brandId:function(t,e){t&&(this.activeBrand=t,this.getTableList())},activeGroupId:function(t,e){t&&(this.activeGroup=t)}},mounted:function(){document.documentElement.style.backgroundColor="#f0f2f5",this.activeBrand=this.brandId,this.brandId&&this.getTableList()},destroyed:function(){document.documentElement.style.backgroundColor="#fff"},components:{appDetail:i.a,commonDetailTop:l.a,vueSelectStore:s.a,multipleDel:r.a}},b={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"daily-set-wrap "},[a("common-detail-top",{attrs:{topMenuData:t.topMenuData,activeId:t.activeId}}),t._v(" "),a("div",{staticClass:"daily-set-content boder-box"},[a("div",{staticClass:"table-condition flex flex-space-between m-b-23"},[a("div",{staticClass:"table-condition-left"},[a("el-input",{staticClass:"w-264 m-l-10",staticStyle:{width:"264px"},attrs:{placeholder:"请输入门店名称"},nativeOn:{keyup:function(e){return a=e,t.toInput(a,t.conditionObj.searchInput);var a}},model:{value:t.conditionObj.searchInput,callback:function(e){t.$set(t.conditionObj,"searchInput",e)},expression:"conditionObj.searchInput"}},[a("i",{staticClass:"el-input__icon el-icon-search",attrs:{slot:"prefix"},slot:"prefix"})]),t._v(" "),a("div",{staticClass:"flex-column item-cell-select inline-block m-l-10"},[a("div",{staticClass:"depart-item-wrap"},[a("div",{staticClass:"el-select el-select--large depart-item-content",staticStyle:{width:"213px"},on:{click:function(e){t.showDialogLayer("store",t.conditionObj.storeGroup)}}},[t.conditionObj.storeGroup.length?t._e():a("span",{staticClass:"font-14 color-c0c4cc"},[t._v("请选择门店分组")]),t._v(" "),a("div",{staticClass:"el-select__tags",staticStyle:{"max-width":"181px"}},[a("span",[t._l(t.conditionObj.storeGroup,function(e,o){return[a("span",{key:o,staticClass:"el-tag el-tag--info el-tag--small"},[a("span",{staticClass:"el-select__tags-text"},[t._v(t._s(e.name||e.storeName))]),a("i",{staticClass:"el-tag__close el-icon-close",on:{click:function(e){e.stopPropagation(),t.delDepart(o,t.conditionObj.storeGroup)}}})])]})],2)])])])]),t._v(" "),a("el-select",{staticClass:"w-105 m-l-10",attrs:{placeholder:"请选择"},on:{change:t.changeStoreType},model:{value:t.conditionObj.storeType,callback:function(e){t.$set(t.conditionObj,"storeType",e)},expression:"conditionObj.storeType"}},t._l(t.storeTypeOptions,function(t){return a("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),t._v(" "),a("el-date-picker",{staticClass:"m-l-10",attrs:{editable:!1,"value-format":"yyyy-MM-dd",type:"daterange",align:"right","unlink-panels":"","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期"},on:{change:t.changeDate},model:{value:t.conditionObj.dateRange,callback:function(e){t.$set(t.conditionObj,"dateRange",e)},expression:"conditionObj.dateRange"}})],1),t._v(" "),a("div",{staticClass:"table-condition-right"},[a("el-button",{attrs:{type:"danger"},on:{click:t.multDel}},[t._v("批量删除")]),t._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:t.exportExcel}},[a("i",{staticClass:"iconfont icon-icon_yunxiazai p-r-6"}),t._v("导出")])],1)]),t._v(" "),a("el-table",{ref:"multipleTable",staticClass:"select-table",style:{width:"100%",minHeight:t.tableH},attrs:{data:t.tableData,"tooltip-effect":"dark"},on:{"selection-change":t.handleSelectionChange}},[a("el-table-column",{attrs:{type:"selection",width:"35"}}),t._v(" "),a("el-table-column",{attrs:{width:"25"},scopedSlots:t._u([{key:"header",fn:function(e){return[a("el-dropdown",{staticStyle:{"line-height":"10px",padding:"0","margin-left":"-15px",transform:"translateY(4px)","-webkit-transform":"translateY(4px)"},attrs:{placement:"bottom-start"},on:{command:t.handleCommand}},[a("span",{staticClass:"el-dropdown-link"},[a("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),t._v(" "),a("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[a("el-dropdown-item",{attrs:{command:"0"}},[a("span",{style:{color:0==t.selectRadio?"#1890ff":"#606266"}},[t._v("选择当页")])]),t._v(" "),a("el-dropdown-item",{attrs:{command:"1"}},[a("span",{style:{color:1==t.selectRadio?"#1890ff":"#606266"}},[t._v("选择全部")])])],1)],1)]}},{key:"default",fn:function(t){}}])}),t._v(" "),a("el-table-column",{attrs:{label:"门店名称",width:"120","show-overflow-tooltip":""},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(e.row.storeName))]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"",label:"任务总数"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(e.row.taskCount))]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"",label:"已完成(含放弃)","show-overflow-tooltip":""},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(e.row.completedCount))]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"",label:"完成率(含放弃)","show-overflow-tooltip":""},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(e.row.completedRate))]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"",label:"待完成","show-overflow-tooltip":""},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(e.row.noCompletedCount))]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"",label:"逾期中","show-overflow-tooltip":""},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(e.row.overdueCount))]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"操作"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{attrs:{type:"text",size:"small"},on:{click:function(a){t.toDetail(e.$index,e.row)}}},[t._v("查看详情")])]}}])})],1),t._v(" "),0!=t.tableData.length?a("div",{staticClass:"block common-wrap__page text-right m-t-24"},[a("el-pagination",{attrs:{background:"","current-page":t.currentPage,"page-sizes":[20,40,60,80],"page-size":t.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:t.total},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}})],1):t._e()],1),t._v(" "),a("multiple-del",{attrs:{showDialog:t.showDialog,detailFlag:!1},on:{hideDialog:t.hideDialog}}),t._v(" "),a("vue-select-store",{ref:"storeSelector",attrs:{currentBrand:t.activeGroup,appScene:t.appScene,treeSet:t.storeTreeSet,selectType:"group",defaultList:t.defaultStoreList},on:{handleSelectedList:t.handleSelectedList}})],1)},staticRenderFns:[]};var f=a("VU/8")(h,b,!1,function(t){a("qsQp")},"data-v-850469a0",null);e.default=f.exports},qsQp:function(t,e){}});