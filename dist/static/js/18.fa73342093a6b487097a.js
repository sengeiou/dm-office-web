webpackJsonp([18],{"738z":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=i("3Xzz"),s=i("elmV"),o=i("P9l9"),n=i("O3H5"),l={name:"employee-io",components:{navCrumb:a.a,uploadExcelComponent:s.a,exportSet:n.a},data:function(){var t=window.location.origin;return-1!=t.indexOf("localhost")&&(t="http://www.gicdev.com"),{navpath:[{name:"首页",path:"/index"},{name:"通讯录",path:"/administrativeFrame"},{name:"员工档案",path:"/fileSet"},{name:"在职员工",path:"/employeeRecord"},{name:"导入员工档案",path:""}],windowH:window.screen.availHeight-180+"px",host:window.location.origin,type:"import",fileList:[],url:t+"/haoban-manage-web/record/record-template-file-upload",logList:[],loading:!0,pageSize:20,currentPage:1,total:0,tempList:[],dialogVisible:!1}},methods:{handleSizeChange:function(t){this.pageSize=t,this.getErrorNote()},handleCurrentChange:function(t){this.currentPage=t,this.getErrorNote()},resetList:function(t){this.fileList=[],"note"==t&&this.getErrorNote()},getErrorNote:function(){var t=this,e={departmentId:t.$route.query.departmentId,importCode:t.$route.query.importCode,pageNum:t.currentPage,pageSize:t.pageSize};Object(o.a)("/haoban-manage-web/record/find-error-log",e).then(function(e){1==e.data.errorCode?(t.total=e.data.result.totalCount,t.logList=e.data.result.result,t.formatData(e.data.result.template,e.data.result.page.result)):t.$message.error({message:e.data.message})}).catch(function(e){t.$message.error({message:e.message})})},formatData:function(t,e){var i=[];t.forEach(function(t){i.push({fieldCode:t.fieldCode,fieldName:t.fieldName})}),this.tempList=i,this.logList=e,this.loading=!1},beforeAvatarUpload:function(t){var e=t.type?t.type:t.raw.type,i="application/vnd.ms-excel"===e||"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"===e;return i||this.$message.error("文件格式必须为 xls 或 xlsx 格式!"),i},uploadSuccess:function(){this.fileList=[],this.type="note",this.getErrorNote()},submitUpload:function(t){this.$refs[t].submit()},getChange:function(t,e){var i=e.length-1<0?0:e.length-1,a=t.type?t.type:t.raw.type;if(!("application/vnd.ms-excel"===a||"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"===a))return this.$message.error("文件格式必须为 xls 或 xlsx 格式!"),this.fileList.splice(i,1),!1;this.fileList=[e[i]]},callExport:function(){this.dialogVisible=!0},cancelCho:function(){this.dialogVisible=!1}},beforeMount:function(){"note"==this.type&&this.getErrorNote(),this.$nextTick(function(){document.querySelector(".contact-wrap__body").style.overflow="hidden"})},beforeDestroy:function(){document.querySelector(".contact-wrap__body").style.overflow="auto"}},c={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"common-set-wrap record-io-wrap",style:{height:t.windowH}},[i("nav-crumb",{attrs:{navpath:t.navpath}}),t._v(" "),i("div",{staticClass:"right-content"},[i("div",{staticClass:"right-box"},[i("div",{staticClass:"io-container"},[t.dialogVisible?[i("export-set",{on:{cancelCho:t.cancelCho}})]:[t._m(0),t._v(" "),i("el-radio-group",{staticClass:"m-t-20",on:{change:t.resetList},model:{value:t.type,callback:function(e){t.type=e},expression:"type"}},[i("el-radio-button",{attrs:{label:"import"}},[t._v("导入员工档案")]),t._v(" "),i("el-radio-button",{attrs:{label:"export"}},[t._v("导出/修改员工档案")]),t._v(" "),i("el-radio-button",{attrs:{label:"note"}},[t._v("错误记录")])],1),t._v(" "),"import"==t.type?i("div",{staticClass:"handle-area import"},[i("div",{staticClass:"step-div",staticStyle:{"margin-bottom":"90px","line-height":"32px"}},[i("span",{staticClass:"ft-large"},[t._v("①")]),t._v("下载模板\n              "),i("a",{staticClass:"d-u-btn",attrs:{href:t.host+"/haoban-manage-web/record/export-record-template.json"}},[i("el-button",{attrs:{type:"primary"}},[t._v("下载"),i("i",{staticClass:"iconfont icon-icon_yunxiazai m-l-5"})])],1)]),t._v(" "),i("div",{staticClass:"step-div"},[i("span",{staticClass:"ft-large"},[t._v("②")]),t._v("上传员工档案\n              "),i("div",{staticClass:"d-u-btn"},[i("el-upload",{ref:"upload",staticClass:"upload-demo",attrs:{action:t.url,multiple:!1,"file-list":t.fileList,"auto-upload":!1,"before-upload":t.beforeAvatarUpload,"on-success":t.uploadSuccess,"on-change":t.getChange}},[i("el-button",{attrs:{slot:"trigger",size:"small",type:"primary"},slot:"trigger"},[t._v("选取文件")]),t._v(" "),i("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[t._v("文件格式必须为xls或xlsx格式")])],1)],1)]),t._v(" "),i("div",{staticClass:"up-btn-div"},[i("el-button",{attrs:{type:"primary",disabled:0==t.fileList.length},on:{click:function(e){t.submitUpload("upload")}}},[t._v("上传")])],1)]):"export"==t.type?i("div",{staticClass:"handle-area import"},[i("div",{staticClass:"step-div",staticStyle:{"margin-bottom":"90px","line-height":"32px"}},[i("span",{staticClass:"ft-large"},[t._v("①")]),t._v("导出员工档案\n              "),i("a",{staticClass:"d-u-btn"},[i("el-button",{attrs:{type:"primary"},on:{click:t.callExport}},[t._v("下载"),i("i",{staticClass:"iconfont icon-icon_yunxiazai m-l-5"})])],1)]),t._v(" "),i("div",{staticClass:"step-div"},[i("span",{staticClass:"ft-large"},[t._v("②")]),t._v("上传更新后的员工档案\n              "),i("div",{staticClass:"d-u-btn"},[i("el-upload",{ref:"uploadEdit",staticClass:"upload-demo",attrs:{action:t.url,multiple:!1,"file-list":t.fileList,"auto-upload":!1,"on-success":t.uploadSuccess,"on-change":t.getChange}},[i("el-button",{attrs:{slot:"trigger",size:"small",type:"primary"},slot:"trigger"},[t._v("选取文件")]),t._v(" "),i("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[t._v("文件格式必须为xls或xlsx格式")])],1)],1)]),t._v(" "),i("div",{staticClass:"up-btn-div"},[i("el-button",{attrs:{type:"primary",disabled:0==t.fileList.length},on:{click:function(e){t.submitUpload("uploadEdit")}}},[t._v("上传")])],1)]):i("div",{staticClass:"error-log import"},[i("div",{staticClass:"title-area"},[t._m(1),t._v(" "),i("a",{attrs:{href:t.host+"/haoban-manage-web/record/error-log-export?importCode="+t.$route.query.importCode}},[i("el-button",{attrs:{type:"primary"}},[t._v("导出错误记录")])],1)]),t._v(" "),i("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"m-t-20",staticStyle:{width:"100%"},attrs:{data:t.logList,height:"400"}},[i("el-table-column",{attrs:{type:"index",width:"50",label:"序号"}}),t._v(" "),i("el-table-column",{attrs:{width:"200",prop:"fieldValue",label:"字段值"}}),t._v(" "),i("el-table-column",{attrs:{width:"200",prop:"fieldName",label:"字段名"}}),t._v(" "),i("el-table-column",{attrs:{width:"200",prop:"failReason",label:"错误原因"}}),t._v(" "),t._l(t.tempList,function(t){return[i("el-table-column",{key:t.fieldCode,attrs:{width:"200",label:t.fieldName,prop:t.fieldCode}})]})],2),t._v(" "),t.logList.length?i("el-pagination",{staticClass:"pagination",attrs:{background:"","page-sizes":[20,40,60,80],"page-size":t.pageSize,"current-page":t.currentPage,layout:"total, sizes, prev, pager, next",total:t.total},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}}):t._e()],1)]],2)])]),t._v(" "),i("vue-gic-footer")],1)},staticRenderFns:[function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("ul",{staticClass:"tip-area"},[i("li",{staticClass:"tip"},[t._v("\n              姓名必须和好办企业通讯录中的员工姓名保持一致，手机号必须为员工注册好办的手机号\n            ")]),t._v(" "),i("li",{staticClass:"tip"},[t._v("\n              员工档案导入时，直接以手机号去做匹配，通讯录中不存在的将无法导入（模板中配置的部门、职位、code，这些字段信息请保持与企业通讯录中一致，这几个字段的信息将不会修改通讯录的信息，直接取该成员对应的通讯录的字段信息）\n            ")]),t._v(" "),i("li",{staticClass:"tip"},[t._v("如果想要新增字段，可在后台档案设置中增加，再导入模板")]),t._v(" "),i("li",{staticClass:"tip"},[t._v("字段类型为图片上传、多选的字段无法导入、导出")]),t._v(" "),i("li",{staticClass:"tip"},[t._v("确保导入的表头字段和后台配置表头字段的名称一致（模板下载时间不可修改）")]),t._v(" "),i("li",{staticClass:"tip"},[t._v("\n              由于数据量可能较大，每次最多导入2000条员工档案，若超过只取前2000条，可以分多次导入\n            ")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"tip"},[this._v("导入总条数：0条，成功导入0条，"),e("span",{staticClass:"red"},[this._v("错误导入0条")])])}]};var r=i("VU/8")(l,c,!1,function(t){i("z7Dl")},null,null);e.default=r.exports},J8vX:function(t,e){},O3H5:function(t,e,i){"use strict";var a=i("mvHQ"),s=i.n(a),o=i("P9l9"),n=i("DAYN"),l={name:"export-set",components:{draggable:i.n(n).a},data:function(){return{tempList:[],checkList:[],origin:[],checkAll:!1,isIndeterminate:!1,checkedList:[]}},methods:{deleteField:function(t){this.checkedList.splice(t,1);var e=this.checkedList.map(function(t){return t.fieldCode});this.origin.forEach(function(t,i){e.includes(t.fieldCode)?t.checked=!0:t.checked=!1}),this.checkHalf()},checkHalf:function(){if(0===this.checkedList.length)return this.isIndeterminate=!1,!1;this.checkedList.length===this.origin.length?this.isIndeterminate=!1:this.isIndeterminate=!0},checkThis:function(t){var e=this;t.checked?e.checkedList.push(t):e.checkedList.forEach(function(i,a){i.fieldCode===t.fieldCode&&e.checkedList.splice(a,1)}),e.checkHalf()},handleCheckAllChange:function(t){this.checkedList=[],this.origin.forEach(function(e,i){e.checked=t,t&&(e.order=i+1)}),t&&(this.checkedList=this.origin.slice(0)),this.checkHalf()},getTemplate:function(){var t=this;Object(o.a)("/haoban-manage-web/record/employee-find-template",{}).then(function(e){1==e.data.errorCode?t.formatTemplateList(e.data.result):t.$message.error({message:e.data.message})}).catch(function(e){t.$message.error({message:e.message})})},formatTemplateList:function(t){var e=[],i=[],a=t;t.forEach(function(t){t.title=t.fieldName,t.name=t.fieldName,t.checked=!1;var i=[];a.forEach(function(e){e.parentCode==t.fieldCode&&i.push(e)}),i.sort(function(t,e){return 1*t.sort-1*e.sort}),i.length>0&&(t.childrens=i),0==t.parentCode&&e.push(t)}),e.sort(function(t,e){return 1*t.sort-1*e.sort}),e.forEach(function(t){i=i.concat(t.childrens)}),this.origin=i,this.tempList=e},cancelCho:function(){this.origin.forEach(function(t){t.checked=!1}),this.$emit("cancelCho")},exportCho:function(){var t=[];this.checkedList.forEach(function(e){e.checked&&t.push({fieldCode:e.fieldCode,fieldName:e.fieldName})});s()(t);var e=window.location.origin;-1!=e.indexOf("localhost")&&(e="http://www.gicdev.com"),location.href=e+"/haoban-manage-web/record/define-export?exportTitleContent="+s()(t),this.$emit("cancelCho")}},beforeMount:function(){this.getTemplate()}},c={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"export-set-container"},[t._m(0),t._v(" "),i("div",{staticClass:"cho-list"},[i("draggable",{model:{value:t.checkedList,callback:function(e){t.checkedList=e},expression:"checkedList"}},[t._l(t.checkedList,function(e,a){return[e.checked?i("div",{key:e.fieldCode+a,staticClass:"cho"},[t._v(t._s(e.fieldName)+" "),i("i",{staticClass:"el-icon-circle-close",on:{click:function(e){t.deleteField(a)}}})]):t._e()]})],2)],1),t._v(" "),i("div",{staticClass:"cho-area"},[i("div",{staticClass:"title"},[t._v("选择需要导出的字段")]),t._v(" "),i("div",{staticClass:"cho-area-group"},[i("div",{staticClass:"group-div"},[i("div",{staticClass:"group-title"}),t._v(" "),i("ul",{staticClass:"group-son-list"},[i("el-checkbox",{attrs:{indeterminate:t.isIndeterminate},on:{change:t.handleCheckAllChange},model:{value:t.checkAll,callback:function(e){t.checkAll=e},expression:"checkAll"}},[t._v("全选")])],1)]),t._v(" "),t._l(t.tempList,function(e,a){return i("div",{key:e.fieldCode+a,staticClass:"group-div"},[i("div",{staticClass:"group-title"},[t._v(t._s(e.title))]),t._v(" "),i("ul",{staticClass:"group-son-list"},[t._l(t.origin,function(a){return[a.parentCode==e.fieldCode?i("li",{key:a.fieldCode},[i("el-checkbox",{key:a.fieldCode,attrs:{label:a.fieldName},on:{change:function(e){t.checkThis(a)}},model:{value:a.checked,callback:function(e){t.$set(a,"checked",e)},expression:"items.checked"}},[t._v(t._s(a.fieldName))])],1):t._e()]})],2)])})],2)]),t._v(" "),i("div",{staticClass:"handle-cho-btn"},[i("el-button",{staticClass:"export-btn",attrs:{type:"primary",disabled:t.checkedList.length<1},on:{click:t.exportCho}},[i("i",{staticClass:"iconfont icon-icon_yunxiazai p-r-6"}),t._v("导出")]),t._v(" "),i("el-button",{on:{click:t.cancelCho}},[t._v("取消")])],1)])},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"title"},[this._v("已选择字段"),e("span",[this._v("导出的列表中将按顺序显示这些字段（可拖拽排序）")])])}]};var r=i("VU/8")(l,c,!1,function(t){i("J8vX")},null,null);e.a=r.exports},z7Dl:function(t,e){}});