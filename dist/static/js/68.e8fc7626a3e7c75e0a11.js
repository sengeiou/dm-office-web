webpackJsonp([68],{"U2+M":function(e,r){},fZsz:function(e,r,t){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var a=t("//Fk"),o=t.n(a),i=t("mvHQ"),n=t.n(i),l=t("3Xzz"),s=t("l46T"),u=t("Kkt8"),c=t("3E4D"),h=t("Ch4/"),d=t("PI0u"),m=t("P9l9"),p={name:"addAdminRole",data:function(){return{menuH:window.screen.availHeight-695+"px",navpath:[{name:"首页",path:"/index"},{name:"设置",path:"/companyAddress"},{name:"设置子管理员",path:"/setChildAdmin"},{name:"新增管理员角色",path:""}],showFlag:!1,ruleForm:{roleId:"",roleName:"",remark:"角色说明",leftChecked:[],menuTree:[],left:[],rightChecked:[],right:[],leftCheckedApp:[],leftApp:[],rightCheckedApp:[],rightApp:[],appRightList:[]},rules:{roleName:[{required:!0,message:"请填写角色名称",trigger:"blur"}],remark:[{required:!0,message:"请填写角色说明",trigger:"blur"}]},defaultProps:{children:"children",label:"rightName"},appDataList:[{appId:"1",appName:"签到",appDesc:"签到",appBackgroudColor:"#1890ff",appIcon:"icon-hangzhengjiagou",appType:0,status:3,remark:"",check:!1}]}},computed:{},methods:{selectApp:function(e){if(this.showFlag)return!1;e.check=!e.check},submitForm:Object(d.a)(function(e){var r=this,t=this;t.$refs[e].validate(function(e){if(!e)return!1;var a=[];r.$refs.tree.getCheckedKeys().concat(r.$refs.tree.getHalfCheckedKeys()).forEach(function(e,r){a.push({rightId:e})}),t.ruleForm.appRightList=[],t.appDataList.forEach(function(e){1==e.check&&t.ruleForm.appRightList.push(e.appId)}),t.postSave(a)})},500),postSave:function(e){var r=this,t={data:n()(e),roleId:r.ruleForm.roleId,roleName:r.ruleForm.roleName,remark:r.ruleForm.remark,brandId:r.ruleForm.brandId,appRightList:r.ruleForm.appRightList.join(",")};Object(m.e)("/haoban-manage-web/save-role",t).then(function(e){var t=e.data;if(1==t.errorCode)return c.a.showmsg("操作成功","success"),void r.$router.push("/setChildAdmin");h.a.errorMsg(t)}).catch(function(e){r.$message.error({duration:1e3,message:e.message})})},getMenuList:function(){var e=this;Object(m.e)("/haoban-manage-web/menu-list",{}).then(function(r){var t=r.data;if(1!=t.errorCode)h.a.errorMsg(t);else{if(t.result&&t.result.length){var a=[];t.result.forEach(function(r,t){e.ruleForm.roleId&&e.showFlag&&(r.disabled=!0),r.display&&a.push(r)}),e.ruleForm.menuTree=e.treeData(a)}e.ruleForm.roleId&&e.getRoleDetail(e.ruleForm.roleId)}}).catch(function(r){e.$message.error({duration:1e3,message:r.message})})},treeData:function(e){return e.filter(function(r){var t=e.filter(function(e){return r.haobanMenuRightId==e.parentRightId});return t.length>0&&(r.children=t),-1==r.parentRightId})},getRoleDetail:function(e){var r=this,t={roleId:e};Object(m.e)("/haoban-manage-web/role-detail",t).then(function(e){var t=e.data;if(1==t.errorCode){if(r.ruleForm.roleId=t.result.role.roleId,r.ruleForm.roleName=t.result.role.roleName,r.ruleForm.roleCode=t.result.role.roleCode,r.ruleForm.remark=t.result.role.remark,r.ruleForm.appRightList=t.result.appRightList||[],r.ruleForm.right.length){var a=r.ruleForm.right.map(function(e){return e.rightId}),o=[];t.result.menuRightList.forEach(function(e,r){a.includes(e.rightId)&&o.push(e.rightId)}),r.ruleForm.rightChecked=o}var i=[];return t.result.menuRightList.forEach(function(e,t){r.$refs.tree.getNode(e.rightId).isLeaf&&i.push(e.rightId)}),r.$refs.tree.setCheckedKeys(i),void r.appDataList.forEach(function(e){r.ruleForm.appRightList.includes(e.appId)&&(e.check=!0)})}h.a.errorMsg(t)}).catch(function(e){r.$message.error({duration:1e3,message:e.message})})},leftChange:function(e,r){var t=this;t.ruleForm.leftChecked=e;var a=e.includes(r[0]);function o(){t.ruleForm.right=[],t.ruleForm.left.forEach(function(e,o){e.rightId.includes(r[0])&&(e.check=!!a,e.children&&e.children.length&&e.children.forEach(function(e,r){t.ruleForm.right.push(e)}))})}e.includes(r[0]),o(),t.ruleForm.rightChecked=t.ruleForm.right.map(function(e){if(!0===e.check)return e.rightId})},rightChange:function(e,r){var t=e.includes(r[0]);this.ruleForm.rightChecked=e,this.ruleForm.left.forEach(function(e,a){e.children&&e.children.length&&e.children.forEach(function(e,a){e.rightId.includes(r[0])&&(e.check=!!t)})})},getAppList:function(){var e=this;Object(m.e)("/haoban-manage-web/application-list",{}).then(function(r){var t=r.data;if(1==t.errorCode)return t.result&&t.result.length&&t.result.forEach(function(e){e.check=!1}),void(e.appDataList=t.result||[]);h.a.errorMsg(t)}).catch(function(r){e.$message.error({duration:1e3,message:r.message})})}},mounted:function(){var e=this;e.$route.query.hasOwnProperty("roleId")&&(e.ruleForm.roleId=e.$route.query.roleId,e.navpath[3].name="管理员角色","show"===e.$route.query.type&&(e.showFlag=!0)),e.$route.query.hasOwnProperty("brandId")&&(e.ruleForm.brandId=e.$route.query.brandId),o.a.all([e.getAppList()]).then(function(r){e.getMenuList()}).catch(function(e){})},components:{navCrumb:l.a,limitInput:s.a,limitTextarea:u.a}},f={render:function(){var e=this,r=e.$createElement,t=e._self._c||r;return t("div",{staticClass:"companyAddress-wrap common-set-wrap"},[t("nav-crumb",{attrs:{navpath:e.navpath}}),e._v(" "),t("div",{staticClass:"right-content"},[t("div",{staticClass:"right-box",style:{"min-height":e.$store.state.bgHeight}},[t("el-form",{ref:"ruleForm",staticClass:"demo-ruleForm",attrs:{model:e.ruleForm,rules:e.rules,"label-width":"100px"}},[t("el-form-item",{attrs:{label:"角色名称",prop:"roleName"}},[t("limitInput",{attrs:{inputWidth:500,inputValue:e.ruleForm.roleName,disflag:!!e.showFlag,holder:"请输入角色名称",maxLength:20},on:{"update:inputValue":function(r){e.$set(e.ruleForm,"roleName",r)}}})],1),e._v(" "),t("el-form-item",{attrs:{label:"角色说明",prop:"remark"}},[t("limitTextarea",{attrs:{inputWidth:500,inputValue:e.ruleForm.remark,holder:"请输入角色说明",disInput:!!e.showFlag,maxLength:50},on:{"update:inputValue":function(r){e.$set(e.ruleForm,"remark",r)}}})],1),e._v(" "),t("el-form-item",{staticClass:"m-t-44",attrs:{label:"菜单权限",prop:"leftChecked"}},[t("div",{staticClass:"w-500 border-1 p-10 border-box el-form-item_menu",style:{"max-height":e.menuH}},[t("el-tree",{ref:"tree",attrs:{data:e.ruleForm.menuTree,"show-checkbox":"","default-expand-all":"","node-key":"rightId","highlight-current":"",props:e.defaultProps}})],1)]),e._v(" "),t("el-form-item",{attrs:{label:"应用权限",prop:""}},[t("div",{staticClass:"apps-content"},[t("ul",{staticClass:"flex flex-row flex-wrap"},e._l(e.appDataList,function(r,a){return t("li",{key:a,class:["flex flex-align-center border-box flex",r.check?"border-active":""],on:{click:function(t){e.selectApp(r)}}},[t("span",{staticClass:"square-item flex flex-align-center flex-pack-center",style:{background:r.appBackgroudColor}},[t("img",{attrs:{src:r.appIcon,alt:""}})]),e._v(" "),t("span",{staticClass:"color-303133 font-14 p-l-8"},[e._v(e._s(r.appName))]),e._v(" "),r.check?t("div",{staticClass:"common-cell_radio"},[t("div",{staticClass:"box-triangle"},[t("div",{staticClass:"wrap__box__outer"},[t("i",{staticClass:"el-icon-upload-success el-icon-check"})])])]):e._e()])}))])]),e._v(" "),t("el-form-item",[t("el-button",{attrs:{disabled:!!e.showFlag,type:"primary"},on:{click:function(r){e.submitForm("ruleForm")}}},[e._v("保 存")])],1)],1)],1)]),e._v(" "),t("vue-gic-footer")],1)},staticRenderFns:[]};var g=t("VU/8")(p,f,!1,function(e){t("U2+M")},"data-v-1f78eae8",null);r.default=g.exports}});